#------------------------------------SLIMMING GO IDS----------------------------
go_data = read.delim(file = 'C:/Users/peree/OneDrive/Desktop/CompBio_Code/QuickGO-annotations-1663870262043-20220922.tsv')
View(go_data)
go_data = go_data[ ,c(3,4)]
View(go_data)
sample_file = read.csv(file = 'C:/Users/peree/OneDrive/Desktop/CompBio_Code/Cdc11_normal-0_ordered_enrichment.xlsx')
View(sample_file)
#------------------------------------SLIMMING GO IDS----------------------------
go_data_cc = read.delim(file = 'C:/Users/peree/OneDrive/Desktop/CompBio_Code/QuickGO-annotations-1663870262043-20220922.tsv')
go_data_cc = go_data[ ,c(3,4)]
sample_file = read.csv(file = 'C:/Users/peree/OneDrive/Desktop/CompBio_Code/Cdc11_normal-0_ordered_enrichment.xlsx')
sample_file = openxlsx::read.xlsx(file = 'C:/Users/peree/OneDrive/Desktop/CompBio_Code/Cdc11_normal-0_ordered_enrichment.xlsx')
sample_file = openxlsx::read.xlsx(xlsxFile = 'C:/Users/peree/OneDrive/Desktop/CompBio_Code/Cdc11_normal-0_ordered_enrichment.xlsx')
View(sample_file)
View(sample_file)
sample_file = dplyr::filter(sample_file$source == 'GO:CC')
sample_file$source
sample_file$source == 'GO:CC'
sample_file = dplyr::filter(sample_file$source == 'GO:CC')
sample_file = dplyr::filter(sample_file, sample_file$source == 'GO:CC')
View(sample_file)
sample_file = openxlsx::read.xlsx(xlsxFile = 'C:/Users/peree/OneDrive/Desktop/CompBio_Code/Cdc11_normal-0_ordered_enrichment.xlsx') %>%
dplyr::filter(sample_file, sample_file$source == 'GO:CC')
sample_file = openxlsx::read.xlsx(xlsxFile = 'C:/Users/peree/OneDrive/Desktop/CompBio_Code/Cdc11_normal-0_ordered_enrichment.xlsx') %>%
dplyr::filter(sample_file, sample_file$source == 'GO:CC')
sample_file = sample_file[ , 14]
sample_file = openxlsx::read.xlsx(xlsxFile = 'C:/Users/peree/OneDrive/Desktop/CompBio_Code/Cdc11_normal-0_ordered_enrichment.xlsx')
sample_file = dplyr::filter(sample_file, sample_file$source == 'GO:CC')
View(sample_file)
sample_file = sample_file[ , c(9, 11, 14)]
View(sample_file)
View(go_data)
View(go_data_cc)
#------------------------------------SLIMMING GO IDS----------------------------
go_data_cc = read.delim(file = 'C:/Users/peree/OneDrive/Desktop/CompBio_Code/QuickGO-annotations-1663870262043-20220922.tsv')
go_data_cc = go_data[ ,c(3,4)]
go_data_cc = go_data_cc[ ,c(3,4)]
a = list()
a = append(list, c(1, 2, 3))
a
b = c(1, 2, 3)
c = c(4, 5, 6)
a = list
a[[b]]
a = a[[b]]
c(a, list(b))
a = c(a, list(b))
a
a = list()
a
a = c(a, as.list(b))
a
a = list()
a = append(a, list(b))
a = append(a, list(c))
a
sample_file[1]
View(sample_file)
i = 0
parent_go = sample_file[i, 3]
i = 1
parent_go = sample_file[i, 3]
for (x in parent_go) {print(x)}
parent_go = stringr::str_split(parent_go, ",")
View(parent_go)
parent_go
for (x in parent_go) {print(x)}
parent_go = stringr::str_split(parent_go, ",")[[1]]
parent_go
parent_go = sample_file[i, 3]
stringr::str_split(parent_go, ",")
stringr::str_split(parent_go, ",")[[1]]
parent_go = sample_file[i, 3]
parent_go = stringr::str_split(parent_go, ",")[[1]]
parent_go
parent_go = sample_file[i, 3]
parent_go = stringr::str_split(parent_go, ", ")[[1]]
parent_go
id = "GO:0005634"
View(go_data_cc)
id %in% go_data_cc$SLIMMED.FROM
sample_file = openxlsx::read.xlsx(xlsxFile = 'C:/Users/peree/OneDrive/Desktop/CompBio_Code/Cdc11_normal-0_ordered_enrichment.xlsx')
sample_file = dplyr::filter(sample_file, sample_file$source == 'GO:CC')
sample_file_subset = sample_file[ , c(9, 11, 14)]
for (i in 1:nrow(sample_file_subset)) {
parent_go = sample_file[i, 3]
parent_go = stringr::str_split(parent_go, ", ")[[1]]
for (id in parent_go) {
}
}
slimmed_list = list()
slimmed_list = append(slimmed_list, list(""))
slimmed_list
slimmed_list = list()
test_data = sample_file_subset
id
parent_go
i
i = 1
parent_go = sample_file_subset[i, 3]
parent_go = stringr::str_split(parent_go, ", ")[[1]]
parent_go
View(sample_file_subset)
id = "GO:0005634"
View(test_data)
test_data = go_data_cc
test_data = dplyr::filter(test_data, test_data$SLIMMED.FROM == id)
View(test_data)
test_data = unique(test_data)
View(test_data)
test_data = go_data_cc
test_data = dplyr::filter(test_data, test_data$SLIMMED.FROM == id)
View(test_data)
parent_go
id='GO:0032991'
test_data = go_data_cc
test_data = dplyr::filter(test_data, test_data$SLIMMED.FROM == id)
View(test_data)
test_data = go_data_cc
test_data = dplyr::filter(test_data, test_data$SLIMMED.FROM == 'GO:0110165')
View(test_data)
test_data = go_data_cc
test_data = dplyr::filter(test_data, test_data$SLIMMED.FROM == 'GO:0030880')
test_data = go_data_cc
test_data = dplyr::filter(test_data, test_data$SLIMMED.FROM == 'GO:0032991')
?unique
intersect(test_data$SLIMMED.FROM, sample_file_subset$parents)
?intersect
a = (1, 2, 3)
a = c(1, 2, 3)
b = c(3, 4, 5)
intersect(a, b)
intersect(test_data$SLIMMED.FROM, sample_file_subset$term_id)
intersect(test_data$GO.TERM, sample_file_subset$term_id)
intersect(test_data$GO.TERM, sample_file_subset$parents)
test_data$GO.TERM
intersect(go_data_cc$SLIMMED.FROM, sample_file_subset$parents)
intersect(go_data_cc$SLIMMED.FROM, sample_file_subset$term_id)
nrows(go_data_cc$SLIMMED.FROM)
nrow(go_data_cc$SLIMMED.FROM)
nrow(go_data_cc)
nrows(sample_file_subset)
nrow(sample_file_subset)
library(stringr)
library(naturalsort)
library(readxl)
library(dplyr)
library(openxlsx)
library(ggplot2)
library(tidyverse)
setwd('C:/Users/peree/OneDrive/Desktop/CompBio_Code/fun_enrich_files/per_marker_unordered/outputs_slim')
dir = 'C:/Users/peree/OneDrive/Desktop/CompBio_Code/fun_enrich_files/per_marker_unordered/outputs_slim'
splitAS = c('with_areashape', 'without_areashape')
compartments = c("cell cortex", "cell wall", "cellular bud", "cellular_component", "chromosome",
"cytoplasm", "cytoplasmic vesicle", "cytoskeleton",
"endomembrane system", "endoplasmic reticulum", "extracellular region", "Golgi apparatus",
"membrane", "microtubule organizing center",
"mitochondrial envelope", "mitochondrion", "nucleolus", "nucleus", "other",
"peroxisome", "plasma membrane", "ribosome", "site of polarized growth",
"vacuole")
f_identifier = function(file_name) {
marker = stringr::str_split(file_name, "_")[[1]][1]
cluster = stringr::str_split(file_name, "_")[[1]][2]
cluster_num = stringr::str_split(cluster, "-")[[1]][2]
cluster_num = paste("Normal ", cluster_num, sep = "")
id = paste(marker, ": ", cluster_num, sep = "")
return(id)
}
fun_enrich_values = function(comps, fun_enrich_df) {
values = c()
i = 1
for (c in comps) {
if (c %in% fun_enrich_df[, 1]) {
values = append(values, as.numeric(fun_enrich_df[i, 2]))
i = i + 1
} else {
values = append(values, NA)
}
}
return(values)
}
fun_enrich_table = function(directory, AS) {
comp_df = data.frame()
marker_dir = paste(directory, "/", AS, sep = "")
markers = list.files(marker_dir)
for (marker in markers) {
file_dir = paste(marker_dir, "/", marker, sep = "")
all_files = naturalsort::naturalsort(list.files(file_dir))
c_files = c()
for (f in all_files) {
if (stringr::str_split(f, "_")[[1]][5] == "cc.xlsx") {
c_files = append(c_files, f)
}
}
for (f in c_files) {
f_path = paste(file_dir, "/", f, sep = "")
f_df = readxl::read_excel(path = f_path)
f_df = f_df[order(f_df$'term_name'), ]
f_df = dplyr::filter(f_df, f_df$'p_value' < 0.01)
if (nrow(f_df) == 0) {
next
}
file_id = f_identifier(f)
f_df_fun_enrich = data.frame(f_df$'term_name', f_df$'p_value')
colnames(f_df_fun_enrich) = c('Term', 'P Value')
fun_enrich_row = c(file_id, fun_enrich_values(compartments, f_df_fun_enrich))
comp_df = rbind(comp_df, fun_enrich_row)
}
}
columns = c("Cluster", compartments)
colnames(comp_df) = columns
return(comp_df)
}
fun_enrich_plots = function(fe_table, AS, plots_path) {
fe_table_noclusters = fe_table[ , 2:ncol(fe_table)]
terms = colnames(fe_table_noclusters)
for (i in 1:ncol(fe_table_noclusters)) {
term = terms[i]
term_df = data.frame(fe_table[, 1], fe_table_noclusters[, i])
colnames(term_df) = c('Cluster', term)
term_df = term_df[order(as.numeric(term_df[,2]), na.last = NA), ]
term_df[ , 2] = as.numeric(term_df[ , 2])
if (nrow(term_df) == 0) {next}
if (nrow(term_df) > 20) {term_df = term_df[1:20, ]}
plot_file = paste(term, "_", AS, ".png", sep = "")
plot_path = paste(plots_path, "/", plot_file, sep = "")
plot_subtitle = ''
if (AS == 'wAS') {plot_subtitle = 'With AreaShape | Unordered Gene Set'}
if (AS == 'woAS') {plot_subtitle = 'Without AreaShape | Unordered Gene Set'}
png(file = plot_path, width = 948, height = 874)
print(ggplot(term_df, aes(x = term_df[ , 2], y = fct_rev(fct_inorder(term_df[ , 1])))) +
geom_bar(stat='identity', fill='#FFB516', width = 0.5) +
labs(x='P Value', y='Marker: Cluster', title=term,
subtitle=plot_subtitle) +
theme(axis.text = element_text(size=10),
axis.title = element_text(face="bold", size=13),
plot.title = element_text(face="bold", hjust = 0.5, size=15),
plot.subtitle = element_text(hjust = 0.5)))
dev.off()
}
}
wAS = fun_enrich_table(dir, "with_areashape")
woAS = fun_enrich_table(dir, "without_areashape")
wAS_plots_directory = 'C:/Users/peree/OneDrive/Desktop/CompBio_Code/fun_enrich_files/per_marker_unordered/outputs_slim/plots/with_areashape_cc'
woAS_plots_directory = 'C:/Users/peree/OneDrive/Desktop/CompBio_Code/fun_enrich_files/per_marker_unordered/outputs_slim/plots/without_areashape_cc'
fun_enrich_plots(wAS, "wAS", wAS_plots_directory)
fun_enrich_plots(woAS, "woAS", woAS_plots_directory)
